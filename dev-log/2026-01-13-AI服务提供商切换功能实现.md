# 2026-01-13 AI服务提供商切换功能实现

## 功能概述

本次开发实现了AI服务提供商的切换功能，支持在腾讯混元AI和阿里云百炼AI之间进行配置切换。通过统一的AI服务接口和Spring的条件配置，实现了灵活的AI服务选择机制。

## 实现细节

### 1. 核心接口设计

**文件**: `backend/src/main/java/com/neoaigc/service/AiService.java`
- 创建了统一的AI服务接口，定义了通用的AI功能方法
- 包括：文生图(textToImage)、图生图(imageToImage)、批量抠图(removeBackground)、人脸替换(faceSwap)
- 为不同的AI服务提供商提供了统一的调用规范

### 2. 服务实现

#### 2.1 腾讯混元AI服务
**文件**: `backend/src/main/java/com/neoaigc/service/HunyuanAiService.java`
- 原有的HunyuanAiService实现了新的AiService接口
- 修改了@Service注解，添加了名称"tencentAiService"
- 保持了原有的功能实现，确保向后兼容

#### 2.2 阿里云百炼AI服务
**文件**: `backend/src/main/java/com/neoaigc/service/AliyunBailianAiService.java`
- 创建了新的阿里云百炼AI服务实现类
- 实现了AiService接口的所有方法
- 由于当前没有可用的阿里云SDK，暂时使用模拟数据
- 为实际API调用预留了扩展空间

### 3. 配置管理

**文件**: `backend/src/main/resources/application.yml`
- 添加了AI服务提供商的配置项：`ai.provider`
- 默认使用腾讯AI服务(tencent)，可选值：tencent、aliyun
- 添加了阿里云百炼AI的配置参数：access-key-id、access-key-secret、endpoint、api-version
- 保持了原有的腾讯混元AI配置不变

### 4. 服务配置类

**文件**: `backend/src/main/java/com/neoaigc/config/AiServiceConfig.java`
- 创建了AI服务配置类，使用Spring的条件配置
- 当`ai.provider`配置为tencent时，使用腾讯混元AI服务
- 当`ai.provider`配置为aliyun时，使用阿里云百炼AI服务
- 提供了默认实现，确保配置缺失时系统仍能正常运行

### 5. Controller层更新

**文件**: `backend/src/main/java/com/neoaigc/controller/TaskController.java`
- 将原来的HunyuanAiService替换为统一的AiService接口
- 更新了import语句和autowired注解
- 修改了executeTask方法中的AI服务调用，使用统一的接口方法
- 确保了Controller层与具体的AI服务实现解耦

### 6. 依赖管理

**文件**: `backend/pom.xml`
- 尝试添加阿里云SDK依赖，但由于仓库中找不到相应包，暂时注释
- 保持了项目的轻量级，使用现有的HTTP客户端工具
- 为后续添加阿里云SDK预留了配置位置

## 切换使用方法

1. **默认配置**：系统默认使用腾讯混元AI服务
2. **配置切换**：在application.yml中修改`ai.provider`配置项
   ```yaml
   ai:
     provider: aliyun  # 切换为阿里云百炼AI服务
   ```
3. **环境变量切换**：可以通过环境变量AI_PROVIDER来动态切换
   ```bash
   export AI_PROVIDER=aliyun
   ```

## 注意事项

1. 阿里云百炼AI服务当前使用模拟数据，实际项目中需要根据API文档实现真实的HTTP请求
2. 腾讯混元AI服务仍使用原有的实现逻辑
3. 两种AI服务的API参数和返回格式可能存在差异，需要根据实际情况进行适配
4. 生产环境中需要配置真实的API密钥和参数

## 后续优化建议

1. 实现阿里云百炼AI的真实API调用
2. 添加AI服务健康检查功能
3. 实现AI服务的动态切换，无需重启服务
4. 添加请求重试和容错机制
5. 优化AI服务的认证方式，提高安全性